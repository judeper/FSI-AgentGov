# Control 2.2: Environment Groups and Tier Classification

## Overview

**Control ID:** 2.2
**Control Name:** Environment Groups and Tier Classification
**Regulatory Reference:** FINRA 4511, GLBA 501(b), SOX 302/404
**Setup Time:** 30-60 min initial setup, ongoing rule configuration

---

## Description

Environment Groups enable consistent governance policy application across multiple Power Platform environments. By grouping environments and applying rules, administrators can enforce sharing limits, channel restrictions, authentication requirements, and AI model governance at scale.

See [Environment groups](https://learn.microsoft.com/en-us/power-platform/admin/environment-groups) for detailed capabilities.

---

## Key Capabilities

| Capability | Description | FSI Relevance |
|------------|-------------|---------------|
| **Group-based rules** | Apply 29 governance rules across grouped environments | Consistent policy enforcement |
| **Zone alignment** | Map environment groups to governance zones | Risk-based governance |
| **Centralized management** | Single location for multi-environment governance | Reduced administrative overhead |
| **Rule inheritance** | New environments inherit group rules automatically | Prevents governance gaps |

---

## Available Rules (29 Total)

Configure rules in PPAC under **Manage → Environment groups → [Group] → Rules**.

### Sharing & Collaboration Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Sharing agents with Editor permissions** | Control co-authoring of agents | Zone 1: Disabled, Zone 2-3: Enabled |
| **Sharing agents with Viewer permissions** | Control agent distribution | Zone 1: Disabled, Zone 2-3: Enabled |
| **Sharing controls for canvas apps** | Limit app sharing broadly | Configure per zone |
| **Sharing controls for solution-aware cloud flows** | Limit flow sharing | Configure per zone |

### Channel & Publishing Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Channel access for published agents** (preview) | Control which channels agents can use | Zone 1: M365 only, Zone 2-3: Configure |

### Authentication & Security Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Authentication for agents** (preview) | Require authentication for agents | Zone 2-3: Required |
| **Enable IP Cookie Binding** | Prevent session hijacking | Zone 3: Enable |
| **IP Firewall setting** | Restrict access by IP | Zone 3: Configure |
| **Content security policy** | Manage content security for Power Apps | Zone 2-3: Configure |

### AI & Generative Features Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **AI prompts** | Enable AI prompts feature | Per organization policy |
| **AI-generated descriptions** (preview) | Auto-generate app descriptions | Per organization policy |
| **AI-powered Copilot features** (preview) | Enable Copilot assistance for makers | Per organization policy |
| **Enable External Models** (preview) | Allow external AI models | Zone 3 only with approval |
| **Preview and experimental AI models** | Allow pre-release AI | Zone 1-2 only |
| **Generative AI setting** | Master toggle for generative AI | Per organization policy |
| **Copilot GSA Settings** | Copilot Government Settings | Government tenants only |

### Maker Experience Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Maker welcome content** | Onboarding guidance for makers | All zones: Configure |
| **Control maker credential options** (preview) | Control credential storage | Zone 2-3: Restrict |

### Solution & Deployment Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Solution checker enforcement** | Validate solutions on import | Zone 2: Warn, Zone 3: Block |
| **Default deployment pipeline** | Link to deployment pipeline | Zone 2-3: Configure |
| **Unmanaged customizations** | Block unmanaged changes | Zone 3: Block |

### Data & Integration Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Advanced connector policies** (preview) | Granular connector control | Zone 2-3: Configure |
| **Computer Use** (preview) | Allow computer use feature | Evaluate carefully |
| **Sharing Copilot Studio agent data with Viva Insights** | Share agent analytics | Per organization policy |

### Operations Rules

| Rule Name | Description | Zone Recommendation |
|-----------|-------------|---------------------|
| **Backup retention** | Configure backup period | Zone 3: Extended retention |
| **Accessing transcripts from conversations** | Control transcript access | Zone 2-3: Configure |
| **Usage insights** | Enable usage analytics | All zones: Enable |
| **Release channel** | Control update cadence | Per organization policy |
| **Power Apps component framework for canvas apps** | Enable PCF components | Per organization policy |

---

## Governance Levels

### Level 1 - Baseline

| Requirement | Configuration |
|-------------|---------------|
| Environment groups created | One group per zone minimum |
| Tier classification | Development, Test, Production |
| Basic rules | Sharing rules configured |

### Level 2-3 - Recommended

| Requirement | Configuration |
|-------------|---------------|
| Zone-aligned groups | Separate groups for Zone 1, Zone 2, Zone 3 |
| Comprehensive rules | Sharing, channels, authentication configured |
| Maker onboarding | Welcome content with policy guidance |
| Solution governance | Solution checker at Warn level |

### Level 4 - Regulated/High-Risk

| Requirement | Configuration |
|-------------|---------------|
| Strict zone separation | Dedicated groups per zone with no overlap |
| All security rules | Authentication, IP binding, firewall configured |
| AI governance | External models restricted, experimental disabled |
| Full audit trail | Transcripts, usage insights enabled |
| Deployment controls | Solution checker at Block, pipelines required |

---

## Zone-to-Group Mapping

**Recommended structure for FSI organizations:**

| Environment Group | Zone | Environments | Key Rules |
|-------------------|------|--------------|-----------|
| **Personal Development** | Zone 1 | Developer environments | Sharing disabled, M365 channels only |
| **Team Collaboration** | Zone 2 | Team/departmental environments | Sharing enabled, internal channels |
| **Enterprise Production** | Zone 3 | Production environments | Strict controls, all rules enforced |
| **Enterprise Non-Prod** | Zone 3 | UAT, staging | Same as production (pre-deployment testing) |

---

## Configuration Steps

### Step 1: Create Environment Groups

1. Open [Power Platform Admin Center](https://admin.powerplatform.microsoft.com)
2. Navigate to **Manage → Environment groups**
3. Click **+ New group**
4. Enter group name (e.g., "Zone 2 - Team Collaboration")
5. Add description with zone classification
6. Click **Save**

### Step 2: Add Environments to Groups

1. Select the environment group
2. Click **Environments** tab
3. Click **Add environments**
4. Select environments to include
5. Click **Add**

### Step 3: Configure Rules

1. Select the environment group
2. Click **Rules** tab (shows 29 available rules)
3. Click on a rule name to configure
4. Set the appropriate value/toggle
5. Click **Save** (or **Publish rules** for batch changes)

### Step 4: Configure Key Rules by Zone

#### Zone 1 - Personal Development

| Rule | Setting |
|------|---------|
| Sharing agents with Editor permissions | Disabled |
| Sharing agents with Viewer permissions | Disabled |
| Channel access for published agents | Teams + M365 Copilot only |
| Enable External Models | Disabled |
| Preview and experimental AI models | Enabled (for learning) |

#### Zone 2 - Team Collaboration

| Rule | Setting |
|------|---------|
| Sharing agents with Editor permissions | Enabled |
| Sharing agents with Viewer permissions | Enabled |
| Channel access for published agents | Teams, SharePoint enabled |
| Authentication for agents | Required |
| Solution checker enforcement | Warn |
| Maker welcome content | Zone 2 policy |

#### Zone 3 - Enterprise Production

| Rule | Setting |
|------|---------|
| Sharing agents with Editor permissions | Disabled (use ALM) |
| Sharing agents with Viewer permissions | Enabled |
| Channel access for published agents | All (with approval) |
| Authentication for agents | Required |
| Enable External Models | Disabled (unless approved) |
| Solution checker enforcement | Block |
| Unmanaged customizations | Block |
| Default deployment pipeline | Configured |

### Step 5: Publish Rules

1. After configuring all rules, click **Publish rules**
2. Rules apply to all environments in the group
3. Verify by checking individual environment settings

---

## Verification & Testing

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | Navigate to Environment groups | Groups listed with environment counts |
| 2 | Check Rules tab | Shows 29 rules with status |
| 3 | Verify rule publication | Status shows "Published" with date |
| 4 | Test in target environment | Rules enforced (e.g., sharing blocked) |
| 5 | Add new environment to group | Inherits group rules automatically |

---

## Integration with Managed Environments

Environment Groups and Managed Environments provide layered governance:

| Control Type | Environment Groups | Managed Environments |
|--------------|-------------------|---------------------|
| Scope | Multiple environments | Single environment |
| Sharing rules | Agent-level controls | Resource-level limits |
| Channels | Publishing restrictions | N/A |
| Solution checker | Via rule | Direct configuration |
| Usage insights | Via rule | Direct configuration |

**Precedence:** More restrictive setting wins when both are configured.

---

## Regulatory Context

**Primary Regulations:** FINRA 4511, GLBA 501(b), SOX 302/404

| Regulation | Environment Group Support |
|------------|--------------------------|
| FINRA 4511 | Consistent recordkeeping controls across environments |
| GLBA 501(b) | Uniform data protection via sharing/channel rules |
| SOX 302/404 | Segregation of duties via tier classification |

---

## Related Controls

- [Control 2.1: Managed Environments](./2.1-managed-environments.md) - Environment-level governance
- [Control 2.15: Environment Routing](./2.15-environment-routing.md) - Automatic maker placement
- [Control 1.4: Advanced Connector Policies](../pillar-1-security/1.4-advanced-connector-policies-acp.md) - Connector governance

---

## Support & Questions

For implementation support or questions about this control, contact:
- AI Governance Lead (governance direction)
- Compliance Officer (regulatory requirements)
- Power Platform Admin (technical setup)

---

*Last Updated: December 2025*
*Version: 1.0 Beta*

# Control 1.1: Restrict Agent Publishing by Authorization

## Overview

**Control ID:** 1.1  
**Control Name:** Restrict Agent Publishing by Authorization  
**Regulatory Reference:** FINRA 4511, SEC Rule 17a-4, GLBA 501(b)  
**Setup Time:** 15-30 min  

---

## Prerequisites

- **License Required:** [Power Platform Premium](https://learn.microsoft.com/en-us/power-platform/admin/pricing-billing-skus) (for Managed Environments)
- **Admin Role:** Power Platform Administrator or Environment Administrator in Microsoft Entra ID
- **Dependencies:**
  - [Control 2.1: Managed Environments](../pillar-2-management/2.1-managed-environments.md) - Recommended for governance features
- **Additional Requirements:** 
  - Security groups configured in Microsoft Entra ID for maker management
  - Environment-level security roles configured

---

## Governance Levels

### Baseline (Level 1)

Limit publishing to known makers via security groups; require documented approval for shared agents.

### Recommended (Level 2-3)

Central publishing workflow + agent registry; enforce environment DLP and connector restrictions.

### Regulated/High-Risk (Level 4)

Formal AI governance committee approval + legal review; change control and evidence retention.

---

## Setup & Configuration

### Portal-Based Configuration (Primary Method)

**Step 1: Create Security Groups for Authorized Makers**

1. Sign in to the **Microsoft Entra Admin Center** ([https://entra.microsoft.com](https://entra.microsoft.com))
2. Navigate to **Identity** > **Groups** > **All groups**
3. Select **New group**
4. Configure the group:
   - **Group type**: Security
   - **Group name**: `FSI-Agent-Makers-Zone2` or `FSI-Agent-Makers-Zone3`
   - **Group description**: `Authorized makers for Zone 2/3 agent development`
   - **Membership type**: Assigned (for strict control) or Dynamic (for automation)
5. Add authorized users as members
6. Select **Create**

[Screenshot needed: Security group creation in Entra ID]

**Step 2: Configure Environment Security Roles**

1. Sign in to the **Power Platform Admin Center** ([https://admin.powerplatform.microsoft.com](https://admin.powerplatform.microsoft.com))
2. Navigate to **Manage** > **Environments**
3. Select the target environment
4. Select **Settings** > **Users + permissions** > **Security roles**
5. Review and configure roles:
   - **Environment Maker**: Can create apps and flows (assign to authorized makers only)
   - **Basic User**: Can run apps but not create (for end users)
   - **System Administrator**: Full control (limit to admins only)
6. Remove Environment Maker role from unauthorized users

[Screenshot needed: Security roles assignment in Power Platform]

**Step 3: Restrict Copilot Studio Access**

1. In Power Platform Admin Center, select the environment
2. Navigate to **Settings** > **Features**
3. Configure the following:
   - **Who can create and edit Copilots**: Select **Only specific security groups**
   - Add the FSI-Agent-Makers security group(s)
4. Select **Save**

[Screenshot needed: Copilot Studio access restriction settings]

**Step 4: Configure Maker Sharing Restrictions (Zone 2/3)**

1. In Power Platform Admin Center, navigate to **Manage** > **Environments**
2. Select your environment > **...** (ellipsis) > **Enable Managed Environments** (if not already)
3. Configure **Limit sharing**:
   - For Zone 2: **Exclude Sharing to Security Groups**
   - For Zone 3: **Do not allow sharing** (strictest)
4. This prevents unauthorized distribution of agents

**Configuration Matrix by Governance Level:**

| Setting | Baseline (Zone 1) | Recommended (Zone 2) | Regulated (Zone 3) |
|---------|-------------------|----------------------|--------------------|
| **Security groups** | Optional | Required | Required + approval |
| **Environment Maker role** | Default access | Restricted to group | Restricted + logged |
| **Copilot Studio access** | All users | Authorized groups | Authorized + reviewed |
| **Sharing restrictions** | None | Exclude sharing to groups | No sharing allowed |
| **Approval workflow** | None | Manager approval | Governance committee |
| **Publishing audit** | Basic | Enhanced | Complete with retention |

**Step 5: Implement Approval Workflow (Zone 2/3)**

For Zone 2 and Zone 3 environments, implement a formal approval process:

1. **Create Approval SharePoint List**:
   - Columns: Agent Name, Creator, Environment, Zone, Approval Status, Approver, Date
   - Configure permissions for Compliance team review

2. **Create Power Automate Approval Flow** (optional automation):
   - Trigger: When agent is ready for production
   - Action: Send approval to designated approvers
   - Outcome: Update registry and notify creator

3. **Document Approval Requirements**:
   - Zone 2: Manager + Compliance acknowledgment
   - Zone 3: Governance Committee + Legal review + Change Advisory Board

### PowerShell Configuration (Alternative Method)

```powershell
# Prerequisites: Install Power Platform Admin modules
# Install-Module -Name Microsoft.PowerApps.Administration.PowerShell -Scope CurrentUser

# Connect to Power Platform
Add-PowerAppsAccount

# Get the environment
$EnvironmentName = "your-environment-id"

# Get current environment permissions
$envPermissions = Get-AdminPowerAppEnvironmentRoleAssignment -EnvironmentName $EnvironmentName
$envPermissions | Format-Table PrincipalDisplayName, RoleType, PrincipalType

# Remove Environment Maker role from "All Users" (if assigned)
$allUsersPermission = $envPermissions | Where-Object { 
    $_.PrincipalType -eq "Tenant" -and $_.RoleType -eq "EnvironmentMaker" 
}
if ($allUsersPermission) {
    Remove-AdminPowerAppEnvironmentRoleAssignment `
        -EnvironmentName $EnvironmentName `
        -RoleId $allUsersPermission.RoleId
    Write-Host "Removed Environment Maker role from All Users" -ForegroundColor Yellow
}

# Add Environment Maker role to authorized security group
$SecurityGroupId = "your-security-group-id"  # Get from Entra ID
Set-AdminPowerAppEnvironmentRoleAssignment `
    -EnvironmentName $EnvironmentName `
    -PrincipalType Group `
    -PrincipalObjectId $SecurityGroupId `
    -RoleName EnvironmentMaker

Write-Host "Environment Maker role assigned to authorized security group" -ForegroundColor Green

# Validation: Check final role assignments
Get-AdminPowerAppEnvironmentRoleAssignment -EnvironmentName $EnvironmentName | 
    Where-Object { $_.RoleType -eq "EnvironmentMaker" } | 
    Format-Table PrincipalDisplayName, PrincipalType
```

---

## Financial Sector Considerations

### Regulatory Alignment

| Regulation | Requirement | How This Control Helps |
|------------|-------------|------------------------|
| **FINRA 4511** | Maintain records of authorized activities | Only authorized makers can publish; all publishing logged |
| **SEC Rule 17a-4** | Record preservation | Publishing events captured in audit log for examination |
| **GLBA 501(b)** | Safeguards for customer data | Restricts who can create agents that access customer data |
| **SOX 302** | Internal controls | Publishing restrictions support segregation of duties |

### Zone-Specific Configuration

**Zone 1 (Personal Productivity):**
- Any licensed user can create and publish personal agents
- No approval workflow required
- Agents cannot be shared broadly
- Rationale: Low risk, no customer data

**Zone 2 (Team Collaboration):**
- Security group membership required to create agents
- Manager approval required before production use
- Monthly access reviews recommended
- Agents can be shared within department only
- Rationale: Internal data access requires accountability

**Zone 3 (Enterprise Managed):**
- Strict security group membership (vetted makers only)
- Governance Committee approval required
- Legal review for customer-facing agents
- Quarterly access certification
- All publishing subject to change control
- Rationale: Customer-facing, regulatory examination risk

### FSI Implementation Example

**Scenario:** Broker-dealer implementing agent publishing controls for compliance agents

**Security Group Structure:**
| Group Name | Members | Permissions |
|------------|---------|-------------|
| FSI-Agent-Makers-Dev | All developers | Zone 1 environments only |
| FSI-Agent-Makers-Team | Senior developers + Business Analysts | Zone 2 environments |
| FSI-Agent-Makers-Prod | Approved makers (5 people) | Zone 3 production environments |

**Approval Workflow:**
1. Developer creates agent in Zone 1 (no approval)
2. Developer requests promotion to Zone 2 (Manager approval + Compliance check)
3. After UAT, requests promotion to Zone 3 (Governance Committee + Legal + CAB)
4. Publishing event logged with approver chain

**Documentation Requirements:**
- Agent purpose and business justification
- Data sources and sensitivity classification
- Connector usage and security review
- Approval chain with dates
- Training completion for creators

---

## Verification & Testing

1. **Attempt to publish as non-authorized maker**:
   - Sign in as a user NOT in the authorized security group
   - Navigate to Copilot Studio
   - Verify access is blocked or limited
   - Expected: Cannot create or publish agents

2. **Publish as authorized maker**:
   - Sign in as a user IN the authorized security group
   - Create a test agent in the appropriate environment
   - Verify publishing succeeds
   - Expected: Can create and publish agents

3. **Check audit log for publish events**:
   - Navigate to Microsoft Purview portal > Audit
   - Search for `Published bot` events
   - Verify all publishing is logged with user identity
   - Expected: All attempts logged with user, timestamp, agent details

4. **Test sharing restrictions** (Zone 2/3):
   - Try to share an agent with "Everyone" or unauthorized group
   - Expected: Sharing blocked per Managed Environment settings

**EXPECTED:** Only authorized makers can publish; all attempts logged

---

## Troubleshooting & Validation

### Common Issues

| Issue | Cause | Resolution |
|-------|-------|------------|
| "User can still create agents" | Security group not applied | Verify group membership; check environment security roles |
| "Authorized user cannot access" | Group sync delay | Wait 15 minutes; have user sign out and back in |
| "Publishing events not in audit" | Audit not enabled or delay | Verify audit is enabled; wait 24-48 hours for new events |
| "Cannot restrict Copilot Studio" | Feature not available | Enable Managed Environments first (Control 2.1) |
| "Sharing still works" | Limit sharing not enabled | Enable in Managed Environment settings |

### How to Confirm Configuration is Active

1. **Via Portal (Entra ID):**
   - Navigate to **Identity** > **Groups** > Select FSI-Agent-Makers group
   - Verify correct members are listed
   - Check no unauthorized users have access

2. **Via Portal (Power Platform):**
   - Navigate to **Manage** > **Environments** > Select environment
   - Go to **Settings** > **Users + permissions** > **Security roles**
   - Verify Environment Maker role is assigned only to authorized groups

3. **Via User Testing:**
   - Have an unauthorized user attempt to access Copilot Studio
   - Verify they cannot create or publish agents
   - Have an authorized user test full workflow

---

## Additional Resources

- [Microsoft Learn: Environment security](https://learn.microsoft.com/en-us/power-platform/admin/database-security)
- [Microsoft Learn: Security roles and privileges](https://learn.microsoft.com/en-us/power-platform/admin/security-roles-privileges)
- [Microsoft Learn: Copilot Studio security and governance](https://learn.microsoft.com/en-us/microsoft-copilot-studio/admin-security-governance)
- [Microsoft Learn: Managed Environments - Limit sharing](https://learn.microsoft.com/en-us/power-platform/admin/managed-environment-sharing-limits)
- [Power Platform Admin Center](https://admin.powerplatform.microsoft.com)

---

## Related Controls

| Control | Relationship |
|---------|--------------|
| [2.1 - Managed Environments](../pillar-2-management/2.1-managed-environments.md) | Enables sharing restrictions and governance features |
| [1.2 - Agent Registry](1.2-agent-registry-and-integrated-apps-management.md) | Tracks all published agents |
| [1.7 - Audit Logging](1.7-comprehensive-audit-logging-and-compliance.md) | Logs all publishing attempts |
| [1.18 - RBAC](1.18-application-level-authorization-and-role-based-access-control-rbac.md) | Broader access control strategy |
| [2.3 - Change Management](../pillar-2-management/2.3-change-management-and-release-planning.md) | Approval workflow for promotions |

---

## Support & Questions

For implementation support or questions about this control, contact:
- **AI Governance Lead** (governance direction)
- **Compliance Officer** (regulatory requirements)
- **Technical Implementation Team** (platform setup)

---

**Last Updated:** December 17, 2025 (Portal UI verified)  
**Version:** 1.0 Beta  
**UI Verification Status:** âœ… Current

*Last Updated: December 2025*  
*Version: 1.0 Beta*

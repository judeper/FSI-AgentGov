# Control 1.7: Comprehensive Audit Logging and Compliance

## Overview

**Control ID:** 1.7
**Control Name:** Comprehensive Audit Logging and Compliance
**Regulatory Reference:** FINRA 4511, SEC 17a-3/4, SOX 302/404, GLBA 501(b)
**Setup Time:** 1-2 hours (Standard) or 8-10 hours (Azure WORM)

---

## Description

Microsoft Purview Audit provides comprehensive logging of user and admin activities across Microsoft 365, including Copilot and agent interactions. Audit logs are essential for compliance monitoring, security investigations, and regulatory examinations.

See [Microsoft Purview Audit](https://learn.microsoft.com/en-us/purview/audit-solutions-overview) for detailed capabilities.

---

## Key Capabilities

| Capability | Description | FSI Relevance |
|------------|-------------|---------------|
| **Unified audit log** | Single log for all M365 activities | Comprehensive visibility |
| **Agent activity logging** | Copilot and agent interactions | AI supervision |
| **Search and filter** | Advanced query capabilities | Investigation support |
| **Retention policies** | Configurable retention periods | Regulatory compliance |
| **Export** | Export logs for external systems | SIEM integration |

---

## Audit Navigation

### Accessing Audit

1. Open [Microsoft Purview](https://purview.microsoft.com)
2. Navigate to **Audit** in left navigation
3. Select **Search** to query audit logs

### Audit Sub-Pages

| Page | Purpose | Key Features |
|------|---------|--------------|
| **Search** | Query audit logs | Advanced filters, export |
| **Policies** | Audit retention policies | Custom retention periods |
| **Pay-as-you-go usage** | Usage tracking | Cost monitoring |

### Related Solutions

| Solution | Integration |
|----------|-------------|
| **eDiscovery** | Search audit logs for investigations |
| **Data Security Investigations (preview)** | Security-focused audit analysis |

---

## Audit Search Interface

### Search Metrics

The Search page displays summary metrics:

| Metric | Description |
|--------|-------------|
| **Searches completed** | Number of finished searches |
| **Active searches** | Currently running searches |
| **Active unfiltered searches** | Searches without filters |

### Search Form Fields

| Field | Description | Required |
|-------|-------------|----------|
| **Date and time range (UTC) Start** | Search start date and time | Yes |
| **Date and time range (UTC) End** | Search end date and time | Yes |
| **Keyword Search** | Keywords to search for | No |
| **Admin Units** | Administrative units to filter | No |
| **Activities - friendly names** | Select activities by friendly name | No |
| **Activities - operation names** | Enter operation values (comma-separated) | No |
| **Record Types** | Select record types to search | No |
| **Search name** | Name for the search | No |
| **Users** | Users whose audit logs to search | No |
| **ObjectId (File, folder, or site)** | File, website, or folder name | No |
| **Workloads** | Workloads to search | No |

### Search Actions

| Action | Description |
|--------|-------------|
| **Search** | Execute the search query |
| **Clear all** | Reset all search fields |
| **Copy this search** | Duplicate search parameters |
| **Delete** | Remove saved search |
| **Refresh** | Update search results |

### Search History Table

| Column | Description |
|--------|-------------|
| Search name | Name assigned to the search |
| Job status | Running, Completed, Failed |
| Progress (%) | Completion percentage |
| Search time | Duration of search |
| Total results | Number of records found |
| Creation time (UTC) | When search was created |
| Search performed by | User who ran the search |

---

## Agent-Related Audit Events

### Copilot Activities

| Activity | Description | Record Type |
|----------|-------------|-------------|
| CopilotInteraction | User interaction with Copilot | CopilotInteraction |
| CopilotFeedback | User feedback on Copilot response | CopilotInteraction |
| CopilotPluginUsed | Plugin invoked during interaction | CopilotInteraction |

### Copilot Studio Activities

| Activity | Description | Record Type |
|----------|-------------|-------------|
| AgentCreated | New agent created | CopilotStudio |
| AgentPublished | Agent published to channel | CopilotStudio |
| AgentModified | Agent configuration changed | CopilotStudio |
| AgentInteraction | User interaction with agent | CopilotStudio |

### Power Platform Activities

| Activity | Description | Record Type |
|----------|-------------|-------------|
| PowerPlatformAdminActivity | Admin activities in PPAC | PowerPlatformAdministratorActivity |
| EnvironmentCreated | New environment created | PowerPlatformAdministratorActivity |
| DLPPolicyModified | DLP policy changed | PowerPlatformAdministratorActivity |

---

## Searching for Agent Activities

### Step-by-Step Search

1. Navigate to **Audit → Search**
2. Set **Date and time range** for period of interest
3. In **Activities - friendly names**, select Copilot or agent activities
4. Optionally filter by **Users** or **Workloads**
5. Enter a **Search name** for reference
6. Click **Search**
7. Review results and export as needed

### Example Searches for FSI

| Scenario | Search Parameters |
|----------|-------------------|
| All Copilot interactions | Activities: CopilotInteraction, Date range: Last 30 days |
| Agent creation events | Activities: AgentCreated, AgentPublished |
| Admin changes to agents | Record Types: CopilotStudio, Activities: *Modified |
| User-specific activity | Users: specific user, Activities: CopilotInteraction |

---

## Audit Retention

### Standard vs Premium

| Feature | Audit (Standard) | Audit (Premium) |
|---------|------------------|-----------------|
| Log retention | 180 days | Up to 10 years |
| Custom policies | No | Yes |
| High-value events | No | Yes |
| Intelligent insights | No | Yes |

### Creating Retention Policies

1. Navigate to **Audit → Policies**
2. Click **Create policy**
3. Configure retention period
4. Select record types to retain
5. Assign to users or entire organization
6. Save policy

### FSI Retention Requirements

| Zone | Minimum Retention | Recommended |
|------|-------------------|-------------|
| Zone 1 | 180 days (Standard) | 1 year |
| Zone 2 | 1 year | 7 years |
| Zone 3 | 7 years | 10 years |

---

## Governance Levels

### Level 1 - Baseline

| Requirement | Configuration |
|-------------|---------------|
| Audit enabled | Standard audit logging active |
| Review cadence | Monthly audit log review |
| Export procedure | Manual export for key events |

**Minimum requirements:**
- Verify audit logging is enabled
- Document audit review procedures
- Export key events monthly

### Level 2-3 - Recommended

| Requirement | Configuration |
|-------------|---------------|
| Audit Premium | Extended retention (1+ years) |
| Retention policies | Custom policies per zone |
| SIEM integration | Export to security monitoring |
| Scheduled searches | Weekly agent activity reviews |

**FSI recommendations:**
- Enable Audit Premium for extended retention
- Create retention policies for Zone 2/3 agents
- Integrate with SIEM for real-time monitoring
- Weekly review of agent audit events

### Level 4 - Regulated/High-Risk

| Requirement | Configuration |
|-------------|---------------|
| 10-year retention | Audit Premium or Azure immutable storage |
| Continuous monitoring | Real-time audit alerts |
| Immutable storage | Azure WORM for regulatory compliance |
| Anomaly detection | Automated detection of unusual patterns |

**FSI requirements:**
- 10+ year retention for customer-facing agent interactions
- Weekly export to Azure immutable storage
- Continuous anomaly detection for Zone 3 agents
- Quarterly audit log integrity verification

---

## SIEM Integration

### Export Options

| Method | Use Case | Frequency |
|--------|----------|-----------|
| Manual export | Ad-hoc investigations | As needed |
| Management Activity API | Automated export | Continuous |
| Azure Monitor | Real-time streaming | Continuous |
| Microsoft Sentinel | Native integration | Continuous |

### Integration with Sentinel

See [Control 3.9: Microsoft Sentinel Integration](../pillar-3-reporting/3.9-microsoft-sentinel-integration.md) for detailed SIEM integration guidance.

---

## Verification & Testing

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | Navigate to purview.microsoft.com → Audit | Audit dashboard displayed |
| 2 | Access Search page | Search form with all fields visible |
| 3 | Search for Copilot events (last 24 hours) | Results returned (if activity exists) |
| 4 | Check retention policies | Policies configured per zone |
| 5 | Verify export capability | Export completes successfully |
| 6 | Test SIEM integration | Logs appearing in external system |

---

## Regulatory Context

**Primary Regulations:** FINRA 4511, SEC 17a-3/4, SOX 302/404, GLBA 501(b)

| Regulation | Audit Logging Requirement |
|------------|---------------------------|
| FINRA 4511 | Books and records - retain AI interaction logs |
| SEC 17a-3/4 | Record retention for AI-assisted communications |
| SOX 302/404 | Internal controls over AI system logging |
| GLBA 501(b) | Security safeguards including audit trails |

### Examination Considerations

Regulators may request:
- Audit logs for specific time periods
- Evidence of retention policy configuration
- Export of agent interaction logs
- Demonstration of search capabilities
- Proof of immutable storage (Level 4)

### SEC 17a-4 WORM Requirements (Broker-Dealers)

> **Important for Broker-Dealers:** SEC Rule 17a-4(f) requires electronic records to be stored in non-rewritable, non-erasable format (WORM - Write Once, Read Many). Microsoft 365's native audit log retention may not meet this requirement without additional configuration.

**Compliance Options:**

| Option | Description | Compliance Status |
|--------|-------------|-------------------|
| **Azure Immutable Blob Storage** | Export audit logs to Azure with WORM policy | SEC 17a-4(f) compliant |
| **Third-party WORM archive** | Use SEC-approved archival vendor | SEC 17a-4(f) compliant |
| **Microsoft 365 Audit Premium only** | Extended retention without WORM | Not sufficient for SEC 17a-4(f) |

**Recommendation:** Broker-dealers should implement weekly automated export of audit logs to Azure Immutable Blob Storage with a time-based retention policy, or engage a third-party archival solution that has received a SEC no-action letter for Rule 17a-4 compliance.

See [Azure immutable blob storage](https://learn.microsoft.com/en-us/azure/storage/blobs/immutable-storage-overview) for implementation details.

---

## Related Controls

- [Control 1.6: DSPM for AI](./1.6-microsoft-purview-dspm-for-ai.md) - AI interaction visibility
- [Control 1.19: eDiscovery](./1.19-ediscovery-for-agent-interactions.md) - Legal discovery
- [Control 3.2: Usage Analytics](../pillar-3-reporting/3.2-usage-analytics-and-activity-monitoring.md) - Activity monitoring
- [Control 3.9: Sentinel Integration](../pillar-3-reporting/3.9-microsoft-sentinel-integration.md) - SIEM integration

---

## Support & Questions

For implementation support or questions about this control, contact:
- AI Governance Lead (governance direction)
- Compliance Officer (regulatory requirements)
- Microsoft Purview Administrator (technical setup)

---

*Last Updated: December 2025*
*Version: 1.0 Beta*

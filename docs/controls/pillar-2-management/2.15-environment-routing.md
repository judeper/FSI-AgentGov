# Control 2.15: Environment Routing and Auto-Provisioning

**Control ID:** 2.15
**Pillar:** Management
**Regulatory Reference:** OCC 2011-12, FINRA 3110, GLBA 501(b)
**Last UI Verified:** January 2026
**Governance Levels:** Baseline / Recommended / Regulated

---

## Objective

Implement environment routing to automatically direct makers to governed Power Platform environments based on security group membership, preventing the creation of ungoverned "shadow AI" in the default environment.

---

## Why This Matters for FSI

- **OCC 2011-12:** Routes makers to governed environments for operational risk management
- **FINRA 3110:** Enforces routing rules based on role/group membership for supervision
- **GLBA 501(b):** Directs makers to environments with proper data policies for customer protection
- **SOX 302/404:** Provides audit trail of routing decisions for internal controls

---

## Control Description

This control establishes environment routing through:

1. **Resource Type Enablement** - Enable routing for Power Apps, Power Automate, and Copilot Studio
2. **Security Group Rules** - Create routing rules based on AD security group membership
3. **Priority Ordering** - Configure rule priority (1-25) for complex organizational structures
4. **Developer Environment Provisioning** - Auto-create personal dev environments on first use
5. **Catch-All Rules** - Ensure "Everyone" rule at lowest priority to prevent default environment fallback
6. **Shadow AI Prevention** - Monitor default environment for unauthorized resource creation

---

## Key Configuration Points

- Access Environment Routing in PPAC → Manage → Environment groups → Environment routing
- Enable routing for all resource types (Power Apps, Flows, Copilot Studio)
- Create security group-based routing rules with appropriate priority
- Include "Everyone" catch-all rule at lowest priority
- Configure developer environment auto-provisioning for personal productivity
- Implement default environment monitoring for shadow AI detection
- Document routing rules for compliance evidence

---

## Zone-Specific Requirements

| Zone | Requirement | Rationale |
|------|-------------|-----------|
| **Zone 1** (Personal) | Route to developer environments; basic governance | Personal use with baseline controls |
| **Zone 2** (Team) | Route to team environments; documented routing rules; DLP applied | Shared agents warrant controlled placement |
| **Zone 3** (Enterprise) | Route to production environments; full governance; zero tolerance for shadow AI | Customer-facing requires strictest routing |

---

## Roles & Responsibilities

| Role | Responsibility |
|------|----------------|
| Power Platform Admin | Configure routing rules, manage environment groups |
| Environment Admin | Environment-level administration |
| Entra Security Admin | Validate routing aligns with security policies |
| Compliance Officer | Approve routing policy, review shadow AI reports |

---

## Related Controls

| Control | Relationship |
|---------|--------------|
| [2.1 - Managed Environments](2.1-managed-environments.md) | Routed environments should be managed |
| [2.2 - Environment Groups](2.2-environment-groups-and-tier-classification.md) | Routing targets environment groups |
| [1.1 - Restrict Agent Publishing](../pillar-1-security/1.1-restrict-agent-publishing-by-authorization.md) | Complements routing with publishing controls |
| [1.4 - Advanced Connector Policies](../pillar-1-security/1.4-advanced-connector-policies-acp.md) | DLP policies apply in routed environments |

---

## Implementation Guides

> For step-by-step implementation, see the playbooks:

- [Portal Walkthrough](../../playbooks/control-implementations/2.15/portal-walkthrough.md) - Step-by-step portal configuration
- [PowerShell Setup](../../playbooks/control-implementations/2.15/powershell-setup.md) - Scripts for automation
- [Verification & Testing](../../playbooks/control-implementations/2.15/verification-testing.md) - Test cases and evidence collection
- [Troubleshooting](../../playbooks/control-implementations/2.15/troubleshooting.md) - Common issues and resolutions

---

## Verification Criteria

Confirm control effectiveness by verifying:

1. Environment routing enabled for all resource types in PPAC
2. Routing rules exist with correct security group assignments
3. Test user creation routes to expected environment based on group membership
4. Default environment monitored for unauthorized resource creation
5. Catch-all "Everyone" rule present at lowest priority

---

## Additional Resources

- [Microsoft Learn: Environment Routing](https://learn.microsoft.com/en-us/power-platform/admin/default-environment-routing)
- [Microsoft Learn: Environment Groups](https://learn.microsoft.com/en-us/power-platform/admin/environment-groups)
- [Microsoft Learn: Create Developer Environments](https://learn.microsoft.com/en-us/power-platform/developer/create-developer-environment)
- [Microsoft Learn: Managed Environments](https://learn.microsoft.com/en-us/power-platform/admin/managed-environment-overview)

---

*Updated: January 2026 | Version: v1.2 | UI Verification Status: Current*

# Control 1.8: Runtime Protection and External Threat Detection

**Control ID:** 1.8
**Pillar:** Security
**Regulatory Reference:** FINRA Notice 25-07, SEC AI priorities, GLBA 501(b)
**Last UI Verified:** January 2026
**Governance Levels:** Baseline / Recommended / Regulated

---

## Objective

Implement runtime security controls for Copilot Studio agents to detect and block prompt injection attacks, jailbreak attempts, and malicious agent behavior. This control provides real-time protection against adversarial inputs and external threats targeting AI agents.

---

## Why This Matters for FSI

- **FINRA Notice 25-07:** Demonstrate AI governance and risk controls for agent operations
- **SEC AI Priorities:** Implement appropriate safeguards for AI-driven customer interactions
- **GLBA 501(b):** Protect customer NPI from exfiltration via AI agents
- **OCC 2011-12:** Model risk controls for AI/ML systems handling financial data
- **FFIEC Guidance:** Cybersecurity controls for fintech and AI applications

---

## Control Description

Runtime Protection provides real-time security controls for Copilot Studio agents, detecting and blocking attacks before they execute. Combined with egress controls and SIEM integration, this creates a defense-in-depth approach to agent security.

| Capability | Description |
|------------|-------------|
| Prompt injection prevention | Block attempts to manipulate agent behavior through malicious inputs |
| Jailbreak detection | Identify attempts to bypass agent guardrails |
| Content moderation | Filter harmful, inappropriate, or sensitive content |
| Egress controls | Prevent data exfiltration via tools and connectors |
| External threat detection | Real-time evaluation via third-party security providers (preview) |

### AI-Enabled Threat Patterns (NYDFS Cyber Guidance)

NYDFS cybersecurity guidance emphasizes detection of AI-enabled attack techniques. Runtime protection should address:

| Threat Pattern | Detection Approach | FSI Impact |
|----------------|-------------------|------------|
| **AI-Generated Phishing** | Analyze prompts for social engineering patterns targeting employee credentials or customer data | Account takeover, unauthorized transactions |
| **Deepfake Impersonation** | Detect requests referencing voice/video verification or C-suite authorization claims | Wire fraud, unauthorized approvals |
| **Synthetic Identity Prompts** | Flag prompts containing combinations of personal data that may indicate synthetic identities | KYC/AML bypass, fraudulent account creation |
| **Adversarial Data Extraction** | Block multi-turn conversations attempting to aggregate sensitive data incrementally | Data exfiltration, MNPI exposure |
| **AI-Assisted Reconnaissance** | Detect prompts probing for system architecture, security controls, or employee information | Targeted attacks, insider threat enablement |

**Detection Configuration:**

1. Enable runtime protection with expanded pattern library for AI-enabled attacks
2. Configure alert thresholds for social engineering indicators
3. Integrate with security awareness training for detected attack patterns
4. Report AI-enabled attack attempts to security operations within 15-minute SLA (Zone 3)

---

## Key Configuration Points

- Enable Managed Environments (required prerequisite)
- Configure agent security settings in Power Platform Admin Center
- Enable runtime protection with prompt injection and jailbreak detection
- Configure content moderation with strict thresholds for regulated agents
- Implement egress controls via DLP and connector allowlists (Control 1.4)
- Set up alert policies in Microsoft Purview for security events
- Integrate with SIEM for real-time monitoring (Tier 2-3)
- Consider external threat detection webhook (preview, requires vendor assessment)

---

## Zone-Specific Requirements

| Zone | Requirement | Rationale |
|------|-------------|-----------|
| **Zone 1** (Personal) | Runtime protection optional; log-only mode; best-effort response | Low risk, reduced friction |
| **Zone 2** (Team) | Runtime protection required; block and log; 4-hour response SLA | Shared agents require accountability |
| **Zone 3** (Enterprise) | Maximum protection; block and investigate; 15-minute response SLA; incident playbook required | Customer-facing, highest risk |

---

## Roles & Responsibilities

| Role | Responsibility |
|------|----------------|
| Power Platform Admin | Environment configuration and runtime protection settings |
| Security Operations | Monitor alerts and investigate threats |
| Entra Security Admin | App registration for external threat detection |
| AI Governance Lead | Agent security policies and incident playbooks |

---

## Related Controls

| Control | Relationship |
|---------|--------------|
| [2.1 - Managed Environments](../pillar-2-management/2.1-managed-environments.md) | Required prerequisite for runtime protection |
| [1.7 - Audit Logging](1.7-comprehensive-audit-logging-and-compliance.md) | Logs runtime protection events |
| [1.4 - Advanced Connector Policies](1.4-advanced-connector-policies-acp.md) | Egress controls complement runtime protection |
| [1.12 - Insider Risk Detection](1.12-insider-risk-detection-and-response.md) | Insider threat correlation |
| [2.7 - Vendor Risk Management](../pillar-2-management/2.7-vendor-and-third-party-risk-management.md) | Third-party webhook provider assessment |

---

## RAI Telemetry Capture (Copilot Studio)

For Copilot Studio agents, **Application Insights integration** enables capture of Responsible AI (RAI) content filtering events that are not available in Microsoft Purview audit logs.

### Why RAI Telemetry Matters

| Event Type | Source | What It Captures |
|------------|--------|------------------|
| **ContentFiltered** | Application Insights | RAI safety filter blocked agent response |
| **PolicyDetails** | Purview Audit | DLP/sensitivity policy enforcement |
| **XPIADetected** | Purview Audit | Cross-prompt injection attempts |

RAI telemetry captures blocking events at the **model layer** (Azure AI Content Safety) rather than the **governance layer** (Microsoft Purview). Both are necessary for complete deny event visibility.

### Application Insights Setup

**Prerequisites:**
- Azure subscription with Application Insights resource
- Copilot Studio Premium license (per-agent telemetry configuration)
- Application Insights connection string

**Configuration per Agent:**

1. Open Copilot Studio > Select agent > **Settings** > **Generative AI**
2. Enable **Advanced settings** toggle
3. Under **Application Insights**, enter connection string
4. Save and publish agent

!!! warning "Per-Agent Configuration"
    Application Insights must be configured for each Copilot Studio agent individually. There is no tenant-wide setting. Include this in agent onboarding checklists for Zone 2/3 agents.

### KQL Query for ContentFiltered Events

```kql
customEvents
| where timestamp > ago(24h)
| where name == "MicrosoftCopilotStudio"
| extend eventType = tostring(customDimensions["EventType"])
| where eventType == "ContentFiltered"
| extend
    agentId = tostring(customDimensions["BotId"]),
    sessionId = tostring(customDimensions["ConversationId"]),
    filterReason = tostring(customDimensions["FilterReason"])
| project timestamp, agentId, sessionId, filterReason, customDimensions
| order by timestamp desc
```

### Zone-Specific Requirements

| Zone | RAI Telemetry Requirement |
|------|---------------------------|
| **Zone 1** | Optional; log-only for awareness |
| **Zone 2** | Required for shared agents; daily review |
| **Zone 3** | Required; real-time alerting; 15-minute response SLA |

### Correlation with Purview Audit

For comprehensive deny event correlation across RAI telemetry, Purview audit, and DLP events, see:

- [Deny Event Correlation Report Playbook](../../playbooks/advanced-implementations/deny-event-correlation-report/index.md) - Multi-source correlation with Power BI dashboard

---

## Implementation Guides

> For step-by-step implementation, see the playbooks:

- [Portal Walkthrough](../../playbooks/control-implementations/1.8/portal-walkthrough.md) - Step-by-step portal configuration
- [PowerShell Setup](../../playbooks/control-implementations/1.8/powershell-setup.md) - Scripts for automation
- [Verification & Testing](../../playbooks/control-implementations/1.8/verification-testing.md) - Test cases and evidence collection
- [Troubleshooting](../../playbooks/control-implementations/1.8/troubleshooting.md) - Common issues and resolutions

---

## Verification Criteria

Confirm control effectiveness by verifying:

1. Managed Environment is enabled for all regulated environments
2. Runtime protection settings are configured and active
3. Test prompt injection is blocked with log entry
4. Egress controls block unauthorized connector/tool invocations
5. Alert policies trigger on security events
6. SIEM integration streams events within SLA (Tier 2-3)

---

## Additional Resources

- [Microsoft Learn: Managed Environments Overview](https://learn.microsoft.com/en-us/power-platform/admin/managed-environment-overview)
- [Microsoft Learn: Copilot Studio Security](https://learn.microsoft.com/en-us/microsoft-copilot-studio/security-and-governance)
- [Microsoft Learn: External Threat Detection](https://learn.microsoft.com/en-us/microsoft-copilot-studio/external-security-provider)
- [Microsoft Learn: Power Platform Security Best Practices](https://learn.microsoft.com/en-us/power-platform/admin/security/security-overview)
- [Microsoft Learn: AI Safety and Content Moderation](https://learn.microsoft.com/en-us/azure/ai-services/content-safety/overview)

---

*Updated: January 2026 | Version: v1.2 | UI Verification Status: Current*

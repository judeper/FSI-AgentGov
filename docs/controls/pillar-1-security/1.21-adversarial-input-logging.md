# Control 1.21: Adversarial Input Logging

**Control ID:** 1.21
**Pillar:** Security
**Regulatory Reference:** FFIEC CAT 2025, GLBA 501(b), FINRA 4511, OCC 2011-12
**Last UI Verified:** January 2026
**Governance Levels:** Baseline / Recommended / Regulated

---

## Objective

Implement detection and logging capabilities for adversarial inputs targeting AI agents, including prompt injection attacks, jailbreaking attempts, and encoding-based evasion techniques to provide early warning of manipulation attempts and support incident response.

---

## Why This Matters for FSI

- **FFIEC CAT 2025:** Provides AI-specific threat detection for cybersecurity assessment
- **GLBA 501(b):** Administrative safeguards through security event detection and logging
- **FINRA 4511:** Preserves evidence of attack attempts in books and records
- **OCC 2011-12:** Addresses manipulation attempts on AI models for model risk management

---

## Control Description

This control establishes adversarial detection through:

1. **Pattern Detection** - Identify known adversarial patterns (prompt injection, jailbreaking, role manipulation)
2. **Encoding Analysis** - Detect obfuscated inputs (Base64, Unicode lookalikes, zero-width characters)
3. **Behavioral Logging** - Log suspicious interaction patterns for investigation
4. **Real-Time Alerting** - Alert SOC on high-confidence attack attempts
5. **Forensic Preservation** - Preserve attack evidence for analysis and regulatory response
6. **Zone-Based Response** - Configure logging, alerting, or blocking based on zone risk

---

## Key Configuration Points

- Enable Copilot interaction logging via Purview Audit (Control 1.7)
- Deploy Defender for Cloud Apps AI monitoring policies
- Configure KQL detection queries for adversarial patterns ("ignore previous", "DAN mode", "system prompt")
- Create Sentinel analytics rules with 5-minute detection windows
- Configure Base64 and Unicode obfuscation detection
- Set zone-specific responses: Zone 1 log-only, Zone 2 alert, Zone 3 block
- Preserve attack evidence per retention schedule (6+ years)

---

## Zone-Specific Requirements

| Zone | Requirement | Rationale |
|------|-------------|-----------|
| **Zone 1** (Personal) | Logging only; weekly review; no blocking | Low risk, avoid disruption |
| **Zone 2** (Team) | Alert on high-confidence attacks; optional soft blocking; weekly review | Balanced approach for shared agents |
| **Zone 3** (Enterprise) | Full detection including encoding; automatic blocking; real-time SOC alerts; quarterly red team | Maximum protection for customer-facing agents |

---

## Roles & Responsibilities

| Role | Responsibility |
|------|----------------|
| Security Administrator | Configure detection rules, manage Sentinel integration |
| Security Operations | Respond to alerts, investigate detected attacks |
| AI Governance Lead | Policy decisions on blocking vs. logging |
| Compliance Officer | Evidence retention requirements, regulatory reporting |

---

## Related Controls

| Control | Relationship |
|---------|--------------|
| [1.7 - Audit Logging](1.7-comprehensive-audit-logging-and-compliance.md) | Provides underlying audit infrastructure |
| [1.8 - Runtime Protection](1.8-runtime-protection-and-external-threat-detection.md) | Complementary threat detection |
| [3.4 - Incident Reporting](../pillar-3-reporting/3.4-incident-reporting-and-root-cause-analysis.md) | Incident response for detected attacks |
| [3.9 - Sentinel Integration](../pillar-3-reporting/3.9-microsoft-sentinel-integration.md) | Advanced analytics and correlation |

---

## Implementation Guides

> For step-by-step implementation, see the playbooks:

- [Portal Walkthrough](../../playbooks/control-implementations/1.21/portal-walkthrough.md) - Step-by-step portal configuration
- [PowerShell Setup](../../playbooks/control-implementations/1.21/powershell-setup.md) - Scripts for automation
- [Verification & Testing](../../playbooks/control-implementations/1.21/verification-testing.md) - Test cases and evidence collection
- [Troubleshooting](../../playbooks/control-implementations/1.21/troubleshooting.md) - Common issues and resolutions

---

## Verification Criteria

Confirm control effectiveness by verifying:

1. Test adversarial prompt ("ignore previous instructions") is logged in audit
2. Sentinel rule triggers alert/incident on pattern match
3. Base64 encoded malicious input is detected by encoding analysis
4. Zone 3 blocking prevents execution of detected attack
5. Detection report generates with summary statistics

---

## Additional Resources

- [Microsoft Learn: Defender for Cloud Apps AI Agent Inventory](https://learn.microsoft.com/en-us/defender-cloud-apps/ai-agent-inventory)
- [Microsoft Learn: Sentinel Analytics Rules](https://learn.microsoft.com/en-us/azure/sentinel/detect-threats-built-in)
- [Microsoft Learn: Purview Audit Log Search](https://learn.microsoft.com/en-us/purview/audit-log-search)
- [OWASP: Top 10 for LLM Applications](https://owasp.org/www-project-top-10-for-large-language-model-applications/)

---

*Updated: January 2026 | Version: v1.1 | UI Verification Status: Current*
